<?xml version="1.0" encoding="UTF-8"?>
<sqls catalog="interInboxQuery">
    <sql key = "inboxQuery" remarks = "Query Inter-Inbox Data by condition">
        <![CDATA[
            SELECT
                inbox.id,
                inbox.src_system_id,
                inbox.subject,
                inbox.message_type,
                inbox.ref_no,
                inbox.service_id,
                inbox.process_url,
                inbox.status,
                inbox.created_dt
            FROM INBOX_MSG AS inbox
            WHERE 1=1
            <#if id??> AND CHARINDEX(:id, inbox.id) >0</#if>
            <#if msgSubject??> AND inbox.subject = :msgSubject</#if>
            <#if messageType??> AND inbox.message_type = :messageType</#if>
            <#if interService??> AND inbox.service_id = :interService</#if>
        ]]>
    </sql>

    <sql key = "applicationQuery" remarks = "Query Inter-Application Data by condition">
        <![CDATA[
        SELECT *
        FROM (SELECT
                app.id,
                app.application_no,
                app.app_type,
                app.status,
                app.service_id,
                app.created_dt
            FROM APPLICATION AS app
             union
            select
                A.ID,A.DRAFT_NO AS application_no,A.APP_TYPE,'APST008' as status,NULL as service_id, A.CREATED_DT
            from
                app_grp_submission_draft AS A
            where  A.status = 'CMSTAT001') AS B
         WHERE 1=1
            <#if id??> AND CHARINDEX(:id, app.id) >0</#if>
            <#if appType??> AND B.app_type = :appType</#if>
            <#if serviceType??> AND B.service_id = :serviceType</#if>
            <#if appNo??> AND B.application_no = :appNo</#if>
            <#if appStatus??> AND B.status = :appStatus</#if>
            <#if createDtStart??> AND B .created_dt > :createDtStart</#if>
            <#if createDtEnd??> AND B .created_dt < :createDtEnd</#if>
        ]]>
    </sql>

    <sql key = "licenceQuery" remarks = "Query Inter-Licence Data by condition">
        <![CDATA[
            SELECT
                lic.id,
                lic.licence_no,
                lic.svc_name,
                lic.status,
                lic.start_date,
                lic.expiry_date,
                (pre.BLK_NO+' '+pre.STREET_NAME+' '+ pre.BUILDING_NAME+' # '+pre.FLOOR_NO+'-'+pre.UNIT_NO+','+pre.POSTAL_CODE) AS premise
            FROM LICENCE AS lic
            JOIN lic_premises AS licpre ON lic.ID = licpre.LICENCE_ID
            JOIN premises AS pre ON licpre.PREMISES_ID = pre.ID
            <#if id??> AND CHARINDEX(:id, lic.id) >0</#if>
            <#if serviceType??> AND lic.svc_name = :serviceType</#if>
            <#if licStatus??> AND lic.status = :licStatus</#if>
            <#if fStartDate??> AND lic.start_date > :fStartDate</#if>
            <#if eStartDate??> AND lic.start_date < :eStartDate</#if>
            <#if fExpiryDate??> AND lic.expiry_date > :fExpiryDate</#if>
            <#if eExpiryDate??> AND lic.expiry_date < :eExpiryDate</#if>
            <#if licNo??> AND lic.licence_no = :licNo</#if>
        ]]>
    </sql>


</sqls>