<?xml version="1.0" encoding="UTF-8"?>
<sqls catalog="interInboxQuery">
    <sql key = "inboxQuery" remarks = "Query Inter-Inbox Data by condition">
        <![CDATA[
            SELECT
                inbox.id,
                inbox.src_system_id,
                inbox.subject,
                inbox.message_type,
                inbox.ref_no,
                inbox.service_id,
                inbox.process_url,
                inbox.status,
                inbox.created_dt
            FROM INBOX_MSG AS inbox
            WHERE 1=1
            <#if id??> AND CHARINDEX(:id, inbox.id) >0</#if>
            <#if msgSubject??> AND inbox.subject = :msgSubject</#if>
            <#if messageType??> AND inbox.message_type = :messageType</#if>
            <#if interService??> AND inbox.service_id = :interService</#if>
        ]]>
    </sql>

    <sql key = "applicationQuery" remarks = "Query Inter-Application Data by condition">
        <![CDATA[
         SELECT *
        FROM (SELECT
                app.id,
                app.application_no,
                app.app_type,
                app.status,
                app.service_id,
                app.created_dt
            FROM APPLICATION AS app
             union
            select
                A.ID,A.DRAFT_NO AS application_no,A.APP_TYPE,'APST008' as status,NULL as service_id, A.CREATED_DT
            from
                app_grp_submission_draft AS A
            where  A.status = 'CMSTAT001') AS B
         WHERE B.STATUS != 'CMSTAT002' AND B.STATUS !='APST009'
            <#if id??> AND CHARINDEX(:id, app.id) >0</#if>
            <#if appType??> AND B.app_type = :appType</#if>
            <#if serviceType??> AND B.service_id = :serviceType</#if>
            <#if appNo??> AND B.application_no like :appNo</#if>
            <#if appStatus??> AND B.status = :appStatus</#if>
            <#if createDtStart??> AND B .created_dt > :createDtStart</#if>
            <#if createDtEnd??> AND B .created_dt < :createDtEnd</#if>
        ]]>
    </sql>

    <sql key = "licenceQuery" remarks = "Query Inter-Licence Data by condition">
        <![CDATA[
            SELECT
                lic.id,
                lic.licence_no,
                lic.svc_name,
                lic.status,
                lic.start_date,
                lic.expiry_date,
                (pre.BLK_NO+' '+pre.STREET_NAME+' '+ pre.BUILDING_NAME+' # '+pre.FLOOR_NO+'-'+pre.UNIT_NO+','+pre.POSTAL_CODE) AS premise
            FROM LICENCE AS lic
            JOIN lic_premises AS licpre ON lic.ID = licpre.LICENCE_ID
            JOIN premises AS pre ON licpre.PREMISES_ID = pre.ID
            WHERE lic.status != 'LICEST002'
            <#if id??> AND CHARINDEX(:id, lic.id) >0</#if>
            <#if serviceType??> AND lic.svc_name = :serviceType</#if>
            <#if licStatus??> AND lic.status = :licStatus</#if>
            <#if fStartDate??> AND lic.start_date > :fStartDate</#if>
            <#if eStartDate??> AND lic.start_date < :eStartDate</#if>
            <#if fExpiryDate??> AND lic.expiry_date > :fExpiryDate</#if>
            <#if eExpiryDate??> AND lic.expiry_date < :eExpiryDate</#if>
            <#if licNo??> AND lic.licence_no like :licNo</#if>
        ]]>
    </sql>

    <sql  key = "feAdminList" remarks = "Query fe admin ">
        <![CDATA[
            SELECT DISTINCT
                acc.ID,
               acc.ID_NO,
               acc.SALUTATION,
               acc.FIRST_NAME,
               acc.LAST_NAME,
               acc.EMAIL_ADDR,
               acc.MOBILE_NO,
               acc.STATUS,
               role.ROLE_ID,
               org.UEN_NO
               FROM user_account acc
               JOIN organization org ON acc.ORGANIZATION_ID = org.ID
               JOIN user_role role ON acc.ID = role.USER_ACCT_ID
                where 1 = 1
                <#if orgid??>AND org.ID = :orgid</#if>
                <#if roleid??>AND role.ROLE_ID = :roleid</#if>
        ]]>
    </sql>

    <sql  key = "feUserList" remarks = "Query user admin ">
        <![CDATA[
            SELECT DISTINCT
                acc.ID,
                acc.FIRST_NAME,
               acc.LAST_NAME,
               acc.SALUTATION,
               acc.ID_TYPE,
               acc.ID_NO,
               acc.DESIGNATION,
               acc.OFFICE_TEL_NO,
               acc.MOBILE_NO,
               acc.EMAIL_ADDR,
               acc.DISPLAY_NAME
               FROM user_account acc
               JOIN organization org ON acc.ORGANIZATION_ID = org.ID
               JOIN user_role role ON acc.ID = role.USER_ACCT_ID
                where 1 = 1
                <#if orgid??>AND org.ID = :orgid</#if>
                <#if roleid??>AND role.ROLE_ID = :roleid</#if>

        ]]>
    </sql>
</sqls>