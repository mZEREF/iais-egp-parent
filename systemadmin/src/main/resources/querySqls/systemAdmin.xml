<?xml version="1.0" encoding="UTF-8"?>
<sqls catalog="systemAdmin">
    <sql key = "masterCodeQuery" remarks = "query MasterCode sql">
        <![CDATA[
            SELECT mc.master_code_id,
                   mc.rowguid,
                   mc.master_code_key,
                   mc.code_category,
                   mc.code_value,
                   mc.code_description,
                   mc.status
            FROM CM_MASTER_CODE AS mc
            WHERE 1=1
            <#if master_code_id??> AND CHARINDEX(:master_code_id, mc.master_code_id) >0</#if>
            <#if master_code_key??> AND mc.master_code_key = :master_code_key</#if>
            <#if code_value??> AND mc.code_value = :code_value</#if>
            <#if master_code_id??> AND mc.master_code_id = :master_code_id</#if>
        ]]>
    </sql>

    <sql key = "findMasterCodeByRowguid" remarks = "Find MasterCode By Rowguid">
        <![CDATA[
            SELECT mc.master_code_id,
                   mc.rowguid,
                   mc.master_code_key,
                   mc.code_category,
                   mc.code_value,
                   mc.code_description,
                   mc.status
            FROM CM_MASTER_CODE AS mc
            WHERE 1=1
            <#if master_code_id??> AND CHARINDEX(:master_code_id, mc.master_code_id) >0</#if>
            <#if rowguid??> AND mc.rowguid = :rowguid</#if>
            <#if master_code_id??> AND mc.master_code_id = :master_code_id</#if>
        ]]>
    </sql>

    <sql key = "queryMessage" remarks = "query message sql">
        <![CDATA[
            SELECT msg_id, code_key, domain_type, msg_type, module, description, message, status
            FROM CM_MESSAGE
            WHERE 1=1 AND status != 'N'
            <#if domainType??> AND domain_type = :domainType</#if>
            <#if msgType??> AND msg_type = :msgType</#if>
            <#if module??> AND module = :module</#if>
        ]]>
    </sql>

    <sql key="querySystemParam" remarks="query system param sql">
        <![CDATA[
            select pid, domain_type , module, description, value_type, value, status, updated_by ,updated_dt
            from cm_system_parameters
            where 1=1 and status != 'n'
            <#if domainType??> and domain_type = :domainType</#if>
            <#if module??> and module = :module</#if>
            <#if description??> and charindex(:description, description) >0</#if>
            <#if status??> and status = :status</#if>
        ]]>
    </sql>


    <sql key="queryFullModeAuditTrail" remarks="query full reocrd for audit trail">
        <![CDATA[
            select audit_id,action_time, operation, nric_number, uen_id, moh_user_id, login_type, session_id, client_ip
            ,user_agent, application_number, license_number, module, function_name, programme_name, before_action,
            after_action, validation_fail_detail, view_params, failed_reason, operation_type from at_audit_trail
            where 1 = 1
            <#if operation??> and operation = :operation</#if>
            <#if nric_number??> and nric_number = :nricnumber</#if>
            <#if startDate??> and action_time >= :startDate </#if>
            <#if endDate??> and action_time <= :endDate </#if>
        ]]>
    </sql>

    <sql key="queryDataMaskModeAuditTrail" remarks="query data mask for audit trail">
        <![CDATA[
            select audit_id,action_time, operation, nric_number, uen_id, moh_user_id, login_type, session_id, client_ip
            ,user_agent, application_number, license_number, module, function_name, programme_name, before_action,
            after_action, validation_fail_detail, view_params, failed_reason, operation_type from at_audit_trail
            where 1 = 1 and operation not in(4, 9, 11, 12, 13, 14, 15, 16, 18, 19, 20, 21, 22, 23, 24 )
            <#if operation??> and operation = :operation</#if>
            <#if nric_number??> and nric_number = :nricnumber</#if>
            <#if startDate??> and action_time >= :startDate </#if>
            <#if endDate??> and action_time <= :endDate </#if>
        ]]>
    </sql>

    <sql key = "queryHcsaService" remarks="query hcsa service parameter of checklist">
        <![CDATA[
            select stype.id as service_id, scategory.id as category_id, scategory.name as category_name, stype.name as service_name
            from iais.dbo.hcsa_service_type stype, iais.dbo.hcsa_service_category scategory where stype.category_id = scategory.id
        ]]>
    </sql>

    <sql key="listChklItem"  remarks="query chechlist items">
        <![CDATA[
                select item.id as item_id, regulation.clause_no as clause_num, regulation.clause as clause,
                item.question as checklistitem, item.answer_type as answer_type, item.risk_level as risk_level,
                item.status as status from chkl_config_hcsa_svc_item_pool item, chkl_config_hcsa_svc_regulation regulation where 1 = 1
                and item.regulation_id = regulation.id and item.status = 'cmstat001'
                <#if itemid??> and charindex(:itemid, item.id) >0</#if>
                <#if regulationclauseno??> and charindex(:regulationclauseno, regulation.clause_no) >0 </#if>
                <#if regulationclause??> and charindex(:regulationclause, regulation.clause) >0 </#if>
                <#if checklistitem??> and charindex(:checklistitem, item.question) >0</#if>
                <#if answertype??> and item.answer_type = :answertype</#if>
                <#if risklevel??> and item.risk_level = :risklevel</#if>
                <#if status??> and item.status = :status</#if>
        ]]>

    </sql>
</sqls>

