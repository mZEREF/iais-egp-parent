/*
 * This file is generated by ECQ project skeleton automatically.
 *
 *   Copyright 2019-2049, Ecquaria Technologies Pte Ltd. All rights reserved.
 *
 *   No part of this material may be copied, reproduced, transmitted,
 *   stored in a retrieval system, reverse engineered, decompiled,
 *   disassembled, localised, ported, adapted, varied, modified, reused,
 *   customised or translated into any language in any form or by any means,
 *   electronic, mechanical, photocopying, recording or otherwise,
 *   without the prior written permission of Ecquaria Technologies Pte Ltd.
 */

package com.ecquaria.cloud.moh.iais.helper;


import com.ecquaria.cloud.moh.iais.common.constant.AppConsts;
import com.ecquaria.cloud.moh.iais.common.constant.AuditTrailConsts;
import com.ecquaria.cloud.moh.iais.common.dto.AuditTrailDto;
import com.ecquaria.cloud.moh.iais.common.utils.MiscUtil;
import com.ecquaria.cloud.moh.iais.common.utils.ParamUtil;
import javax.servlet.http.HttpServletRequest;

/**
 * AuditTrailHelper
 *
 * @author Jinhua
 * @date 2019/8/6 17:58
 */
public class AuditTrailHelper {

    public static void auditFunction(String moduleName, String functionName) {
        auditFunction(moduleName, functionName, null, null);
    }

    public static void auditFunctionWithAppNo(String moduleName, String functionName, String appNo) {
        auditFunction(moduleName, functionName, appNo, null);
    }

    public static void auditFunctionWithLicNo(String moduleName, String functionName, String licNo) {
        auditFunction(moduleName, functionName, null, licNo);
    }

    public static void auditFunction(String moduleName, String functionName, String appNo, String licenceNo) {
        HttpServletRequest request = MiscUtil.getCurrentRequest();
        AuditTrailDto dto = (AuditTrailDto) ParamUtil.getSessionAttr(request,
                AuditTrailConsts.SESSION_ATTR_PARAM_NAME);
        if (dto == null) {
            dto = new AuditTrailDto();
        }

        IaisEGPHelper.setAuditLoginUserInfo(dto);
        dto.setApplicationNum(appNo);
        dto.setLicenseNum(licenceNo);
        dto.setModule(moduleName);
        dto.setFunctionName(functionName);
        ParamUtil.setSessionAttr(request, AuditTrailConsts.SESSION_ATTR_PARAM_NAME, dto);
    }

    public static void setAuditAppNo(String appNo) {
        HttpServletRequest request = MiscUtil.getCurrentRequest();
        AuditTrailDto dto = (AuditTrailDto) ParamUtil.getSessionAttr(request, AuditTrailConsts.SESSION_ATTR_PARAM_NAME);
        dto.setApplicationNum(appNo);
    }

    public static void setAuditLicNo(String licNo) {
        HttpServletRequest request = MiscUtil.getCurrentRequest();
        AuditTrailDto dto = (AuditTrailDto) ParamUtil.getSessionAttr(request, AuditTrailConsts.SESSION_ATTR_PARAM_NAME);
        dto.setLicenseNum(licNo);
    }

    public static AuditTrailDto getBatchJobDto(String domain) {
        AuditTrailDto dto = new AuditTrailDto();
        dto.setNricNumber("System");
        dto.setMohUserId("System");
        dto.setMohUserGuid(AppConsts.USER_ID_SYSTEM);
        dto.setUserDomain(domain);
        dto.setOperationType(AuditTrailConsts.OPERATION_TYPE_BATCH_JOB);
        return dto;
    }

    private AuditTrailHelper() {
        throw new IllegalStateException("Utility class");
    }
}
