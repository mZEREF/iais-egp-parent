/*
 * This file is generated by ECQ project skeleton automatically.
 *
 *   Copyright 2019-2049, Ecquaria Technologies Pte Ltd. All rights reserved.
 *
 *   No part of this material may be copied, reproduced, transmitted,
 *   stored in a retrieval system, reverse engineered, decompiled,
 *   disassembled, localised, ported, adapted, varied, modified, reused,
 *   customised or translated into any language in any form or by any means,
 *   electronic, mechanical, photocopying, recording or otherwise,
 *   without the prior written permission of Ecquaria Technologies Pte Ltd.
 */

package com.ecquaria.cloud.moh.iais.querydao;

import com.ecquaria.cloud.moh.iais.dto.SearchParam;
import com.ecquaria.cloud.moh.iais.helper.SqlHelper;
import org.springframework.stereotype.Component;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;
import java.util.List;
import java.util.Map;

/**
 * BaseQueryDao
 *
 * @author Jinhua
 * @date 2019/7/19 16:16
 */
@Component
public class QueryDao<T> {
    @PersistenceContext
    private EntityManager entityManager;

    public <T> List<T> doQuery(SearchParam param, String catalog, String key){
        String sql = SqlHelper.getQuerySql(catalog, key, param);
        Query query = entityManager.createNativeQuery(sql, param.getEntityCls());
        for (Map.Entry<String, Object> ent : param.getFilters().entrySet()) {
            query.setParameter(ent.getKey(), ent.getValue());
        }
        List<T> list = query.getResultList();

        return list;
    }
}
