<?xml version="1.0" encoding="UTF-8"?>
<sqls catalog="applicationPersonnelQuery">
    <sql key = "appPersonnelQuery" remarks = "Query Application Data by condition">
        <![CDATA[
            SELECT DISTINCT T1.ID,T1.NAME,T1.ID_NO,T1.EMAIL_ADDR,T1.MOBILE_NO,T1.DESIGNATION,T1.SALUTATION,T1.ID_TYPE,T1.OFFICE_TEL_NO
            from hcsal.dbo.key_personnel as T1
            join hcsal.dbo.lic_key_personnel T2 on T1.ID  = T2.PERSON_ID
            join hcsal.dbo.licence T3 on t2.LICENCE_ID = t3.ID
			AND t3.STATUS = 'LICEST001'
			<#if licenseeId??>AND t3.LICENSEE_ID =:licenseeId</#if>
			<#if personName??> AND T1.NAME LIKE :personName</#if>
        ]]>
    </sql>
    <sql remarks="Query" key="queryPremises">
        <![CDATA[
                SELECT li.ID as LICENCE_ID,li.LICENCE_NO as LICENCE_NO,li.STATUS as LICENCE_STATUS, li.SVC_NAME as SVC_NAME,
                p.ID as PREMISES_ID, p.HCI_CODE , p.HCI_NAME, p.HCI_CONTACT_NO, p.SCDF_REF_NO,
                 p.CERT_ISSUED_DT, p.VEHICLE_NO, p.PREMISES_TYPE, p.POSTAL_CODE, p.ADDR_TYPE,
                  p.BLK_NO, p.FLOOR_NO, p.UNIT_NO, p.STREET_NAME, p.BUILDING_NAME, p.VERSION,
                   p.STATUS, p.ORGANIZATION_ID,'' as ADDRESS  FROM
                   licence as li  join lic_premises lp on li.ID = lp.LICENCE_ID
                   join premises p on lp.PREMISES_ID = p.ID WHERE 1 = 1
                   <#if licenseeId??> and li.LICENSEE_ID =:licenseeId </#if>
                   <#if type??> and p.PREMISES_TYPE=:type </#if> and
                   li.STATUS ='LICEST001' and p.ID in (
                   SELECT  max (p.ID) as PREMISES_ID FROM
                   licence as li  join lic_premises lp on li.ID = lp.LICENCE_ID
                   join premises p on lp.PREMISES_ID = p.ID WHERE 1 = 1
                  <#if licenseeId??>   and li.LICENSEE_ID =:licenseeId </#if>and
                   li.STATUS ='LICEST001' group by p.HCI_CODE)]]>
    </sql>
</sqls>

