<?xml version="1.0" encoding="UTF-8"?>
<sqls catalog="applicationPersonnelQuery">
    <sql key = "appPersonnelQuery" remarks = "Query Application Data by condition">
        <![CDATA[
        SELECT T1.ID,T1.NAME,T1.ID_NO,T1.EMAIL_ADDR,T1.MOBILE_NO,T1.DESIGNATION,T1.SALUTATION,T1.ID_TYPE
			    FROM hcsal.dbo.key_personnel T1
			    join hcsal.dbo.lic_key_personnel T2
			    on T1.ID  = T2.PERSON_ID
			    WHERE T1.ID in (select max(T1.ID) from hcsal.dbo.key_personnel as T1 group by T1.ID_NO )
			   <#if name??> and name (:name, T1.NAME) >0</#if>
			   <#if psnType??> and psnType (:psnType, T2.PSN_TYPE) >0</#if>
        ]]>
    </sql>
    <sql remarks="Query" key="queryPremises">
        <![CDATA[
                SELECT li.ID as LICENCE_ID,li.STATUS as LICENCE_STATUS, li.SVC_NAME as SVC_NAME,
                p.ID as PREMISES_ID, p.HCI_CODE , p.HCI_NAME, p.HCI_CONTACT_NO, p.SCDF_REF_NO,
                 p.CERT_ISSUED_DT, p.VEHICLE_NO, p.PREMISES_TYPE, p.POSTAL_CODE, p.ADDR_TYPE,
                  p.BLK_NO, p.FLOOR_NO, p.UNIT_NO, p.STREET_NAME, p.BUILDING_NAME, p.VERSION,
                   p.STATUS, p.ORGANIZATION_ID FROM
                   licence as li  join lic_premises lp on li.ID = lp.LICENCE_ID
                   join premises p on lp.PREMISES_ID = p.ID WHERE 1 = 1
                   <#if licenseeId??> and li.LICENSEE_ID =:licenseeId </#if>
                   <#if type??> and p.PREMISES_TYPE=:type </#if> and
                   li.STATUS ='LICEST001' and li.ID =( select top 1 T1.ID from licence T1 where
                   li.LICENCE_NO =T1.LICENCE_NO order by VERSION desc ) and p.ID in (select max(p.ID) from premises as p group by p.HCI_CODE)
            ]]>
    </sql>
</sqls>

