<?xml version="1.0" encoding="UTF-8"?>
<sqls catalog="assessmentSchematicsQuery">


    <sql key = "applicationQuery" remarks = "Query Inter-Application Data by condition">
        <![CDATA[
         SELECT *
        FROM (SELECT
                app.id,
                app.application_no,
                app.app_grp_id,
                (select LICENSEE_ID from application_group as ag where ag.ID =  app.APP_GRP_ID) as licensee_id,
                app.app_type,
                app.status,
                app.service_id,
                app.created_dt,
                app.version
            FROM APPLICATION AS app
            join (select application_no,MAX(version) as version from application GROUP BY application_no) as app2
            on app.APPLICATION_NO = app2.application_no and app.version = app2.version
            union
            select
                A.ID,A.DRAFT_NO AS application_no,A.app_grp_id,A.licensee_id,A.app_type,'APST008' as status,NULL as service_id, A.CREATED_DT,1
            from
                app_grp_submission_draft AS A
            where  A.status = 'CMSTAT001') AS B
        WHERE B.STATUS != 'CMSTAT002' AND B.STATUS !='APST009' AND B.STATUS !='APST051'
            <#if licenseeId??> AND B.licensee_id = :licenseeId</#if>
            <#if appStatus??> AND B.status = :appStatus</#if>

        ]]>
    </sql>


    <sql  key = "feUserList" remarks = "Query user admin ">
        <![CDATA[
            SELECT DISTINCT
                acc.ID,
                acc.DISPLAY_NAME,
               acc.SALUTATION,
               acc.ID_TYPE,
               acc.ID_NO,
               acc.DESIGNATION,
               acc.IS_AVAILABLE,
               role.ROLE_ID
               FROM user_account acc
               JOIN organization org ON acc.ORGANIZATION_ID = org.ID
               JOIN user_role role ON acc.ID = role.USER_ACCT_ID
                where 1 = 1
                <#if orgid??>AND org.ID = :orgid</#if>
                <#if roleid??>AND role.ROLE_ID = :roleid</#if>

        ]]>
    </sql>
</sqls>