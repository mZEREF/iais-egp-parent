<?xml version="1.0" encoding="UTF-8"?>
<sqls catalog="intraDashboardQuery">
    <sql key = "dashCommonTask" remarks = "Dashboard Search Common Pool Task By Application Group">
        <![CDATA[
            SELECT DISTINCT T5.ID, T5.GROUP_NO, T5.PMT_STATUS, T5.APP_TYPE, T5.SUBMIT_DT, T5.COU FROM
            (SELECT T4.ID, T4.GROUP_NO, T4.PMT_STATUS, T1.ID AS APP_PREM_CORRID, T2.APPLICATION_NO, T4.APP_TYPE, T2.STATUS, T3.HCI_CODE, T3.HCI_NAME, T4.SUBMIT_DT,
             CONCAT(T3.BLK_NO ,
               case T3.STREET_NAME
                  when null then null
                  when '' then null
                  else ' '+T3.STREET_NAME end
               , case T3.BUILDING_NAME
                  when null then null
                  when '' then null
                  else ' '+T3.BUILDING_NAME end
               , case T3.FLOOR_NO
                  when null then null
                  when '' then null
                  else ' # '+T3.FLOOR_NO end
               , case T3.UNIT_NO
                  when null then null
                  when '' then null
                  else '-'+T3.UNIT_NO end
               , case T3.POSTAL_CODE
                  when null then null
                  when '' then null
                  else ', '+T3.POSTAL_CODE end
              ) AS PREMISE,
             T6.COU
             FROM APP_PREMISES_CORRELATION T1
             JOIN APPLICATION T2 ON T2.ID = T1.APPLICATION_ID
             JOIN APP_GRP_PREMISES T3 ON T3.ID = T1.APP_GRP_PREM_ID
             JOIN APPLICATION_GROUP T4 ON T4.ID = T2.APP_GRP_ID
             JOIN (SELECT COUNT(DISTINCT application.APPLICATION_NO) COU, APP_GRP_ID FROM application GROUP BY app_grp_id) as T6 ON T4.ID = T6.app_grp_id
             JOIN TASKVIEW T7 ON T7.REF_NO = T1.ID
             WHERE 1 = 1
             <#if workGroup_list??> and ${workGroup_list} </#if>
             <#if dashRoleId??> and T7.ROLE_ID = :dashRoleId </#if>
             and T7.TASK_STATUS in ('TSTATUS001','TSTATUS002')
             and T7.USER_ID is NULL
            ) T5
            WHERE 1 = 1
            <#if application_no??> and charindex(:application_no, T5.APPLICATION_NO) >0 </#if>
            <#if application_type??> and T5.APP_TYPE = :application_type</#if>
            <#if hci_code??> and charindex(:hci_code, T5.HCI_CODE) >0 </#if>
            <#if hci_name??> and charindex(:hci_name, T5.HCI_NAME) >0 </#if>
            <#if hci_address??> and charindex(:hci_address, T5.PREMISE) >0 </#if>
        ]]>
    </sql>

    <sql key = "dashCommonTaskAjax"  remarks = "get Application By App Group in Common Pool">
        <![CDATA[
            SELECT DISTINCT T5.ID, T5.APP_PREM_ID, T7.ID AS TASK_ID, T5.APPLICATION_NO, T5.SERVICE_ID, T5.STATUS, T5.HCI_CODE
            FROM
                (
                    SELECT T2.ID, T3.ID as APP_PREM_ID, T1.APPLICATION_NO, T1.SERVICE_ID, T1.STATUS, T3.HCI_CODE, T4.GROUP_NO, T1.APP_TYPE
                    FROM APPLICATION T1
                    JOIN APP_PREMISES_CORRELATION T2 ON T2.APPLICATION_ID = T1.ID
                    JOIN APP_GRP_PREMISES T3 ON T3.ID = T2.APP_GRP_PREM_ID
                    JOIN APPLICATION_GROUP T4 ON T4.ID = T1.APP_GRP_ID
                    <#if appCorrId_list??> and ${appCorrId_list} </#if>
                ) T5
            LEFT JOIN TASKVIEW T7 ON T7.REF_NO = T5.ID
            WHERE 1 = 1
            <#if dashFilterAppNo??> and charindex(:dashFilterAppNo, T1.APPLICATION_NO) >0 </#if>
            <#if groupNo??> and T5.GROUP_NO = :groupNo</#if>
            <#if dashRoleId??> and T7.ROLE_ID = :dashRoleId</#if>
            <#if workGroup_list??> and ${workGroup_list} </#if>
        ]]>
    </sql>

    <sql key = "dashKpiTask" remarks = "Dashboard Search Kpi Task By Application Group">
        <![CDATA[
            SELECT DISTINCT T1.ID, T1.GROUP_NO, T1.PMT_STATUS, T1.APP_TYPE, T1.SUBMIT_DT, T1.COU
            FROM APP_GRP_EXCEEDING_DAY_VIEW T1
            LEFT JOIN TASKVIEW T7 ON T7.REF_NO = T1.CORREID
            WHERE 1 = 1
            <#if workGroup_list??> and ${workGroup_list} </#if>
            <#if dashRoleId??> and T7.ROLE_ID = :dashRoleId </#if>
            <#if dashUserId??> and T7.user_id = :dashUserId </#if>
            and T7.TASK_STATUS in ('TSTATUS001','TSTATUS002')
            <#if application_no??> and charindex(:application_no, T1.APPLICATION_NO) >0 </#if>
            <#if application_type??> and T1.APP_TYPE = :application_type</#if>
            <#if application_status??> and T1.STATUS = :application_status</#if>
            <#if hci_code??> and charindex(:hci_code, T1.HCI_CODE) >0 </#if>
            <#if hci_name??> and charindex(:hci_name, T1.HCI_NAME) >0 </#if>
            <#if hci_address??> and charindex(:hci_address, T1.PREMISE) >0 </#if>
        ]]>
    </sql>

    <sql key = "dashKpiTaskAjax"  remarks = "get Application By App Group in Kpi Pool">
        <![CDATA[
            SELECT DISTINCT T1.ID, T1.APP_PREM_ID, T7.ID AS TASK_ID, T1.APPLICATION_NO, T1.SERVICE_ID, T1.STATUS, T1.HCI_CODE
            FROM APP_EXCEEDING_DAY_VIEW T1
            LEFT JOIN TASKVIEW T7 ON T7.REF_NO = T1.ID
            WHERE 1 = 1
            <#if dashFilterAppNo??> and charindex(:dashFilterAppNo, T1.APPLICATION_NO) >0 </#if>
            <#if groupNo??> and T1.GROUP_NO = :groupNo</#if>
            <#if dashRoleId??> and T7.ROLE_ID = :dashRoleId</#if>
            <#if workGroup_list??> and ${workGroup_list}</#if>
            <#if dashUserId??> and T7.user_id = :dashUserId </#if>
        ]]>
    </sql>

    <sql key = "dashWaitApproveTask" remarks = "Dashboard Search Wait Approve Task By Application Group">
        <![CDATA[

        ]]>
    </sql>

    <sql key = "dashWaitApproveAjax"  remarks = "get Application By App Group in Wait Approve Pool">
        <![CDATA[

        ]]>
    </sql>

    <sql key = "dashAppReplyTask" remarks = "Dashboard Search Applicant's Reply By Application Group">
        <![CDATA[

        ]]>
    </sql>

    <sql key = "dashAppReplyAjax"  remarks = "get Application By App Group in Applicant's Reply Pool">
        <![CDATA[

        ]]>
    </sql>

    <sql key = "dashSupervisorTask" remarks = "Dashboard Search Supervisor Task By Application Group">
        <![CDATA[

        ]]>
    </sql>

    <sql key = "dashSupervisorAjax"  remarks = "get Application By App Group in Supervisor Pool">
        <![CDATA[

        ]]>
    </sql>
</sqls>