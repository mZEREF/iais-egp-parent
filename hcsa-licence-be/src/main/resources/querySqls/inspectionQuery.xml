<?xml version="1.0" encoding="UTF-8"?>
<sqls catalog="inspectionQuery">
    <sql key = "assignInspector" remarks = "AO Assign Task For Inspector">
        <![CDATA[
            SELECT T5.ID, T5.APPLICATION_ID, T5.APPLICATION_NO, T5.APP_TYPE, T5.STATUS, T5.HCI_CODE, T5.HCI_NAME, T5.SUBMIT_DT FROM
            (SELECT T1.ID, T1.APPLICATION_ID, T2.APPLICATION_NO, T2.APP_TYPE, T2.STATUS, T3.HCI_CODE, T3.HCI_NAME, T4.SUBMIT_DT,
             (T3.BLK_NO + ' ' + T3.STREET_NAME + ' ' + T3.BUILDING_NAME + ' # '+ T3.FLOOR_NO + '-' + T3.UNIT_NO + ', ' + T3.POSTAL_CODE) AS PREMISE
             FROM APP_PREMISES_CORRELATION T1
             JOIN APPLICATION T2 ON T2.ID = T1.APPLICATION_ID
             JOIN APP_GRP_PREMISES T3 ON T3.ID = T1.APP_GRP_PREM_ID
             JOIN APPLICATION_GROUP T4 ON T4.ID = T2.APP_GRP_ID
             WHERE 1 = 1
             <#if appCorrId_list??> and CONVERT(NVARCHAR(36), T1.ID) IN ${appCorrId_list} </#if>
            ) T5
            WHERE 1 = 1
            <#if application_no??> and charindex(:application_no, T5.APPLICATION_NO) >0 </#if>
            <#if application_type??> and T5.APP_TYPE = :application_type</#if>
            <#if hci_code??> and charindex(:hci_code, T5.HCI_CODE) >0 </#if>
            <#if hci_name??> and charindex(:hci_name, T5.HCI_NAME) >0 </#if>
            <#if sub_date??> and T5.SUBMIT_DT >= :sub_date</#if>
            <#if hci_address??> and charindex(:hci_address, T5.PREMISE) >0 </#if>
        ]]>
    </sql>

    <sql key = "assignInspectorSupper" remarks = "Inspector Leader / Inspector Assign Task For Inspector">
        <![CDATA[
            SELECT T5.ID, T5.APPLICATION_ID, T5.APPLICATION_NO, T5.APP_TYPE, T5.SERVICE_ID, T5.STATUS, T5.HCI_CODE, T5.HCI_NAME, T5.SUBMIT_DT, T5.IS_PRE_INSPECTION FROM
            (SELECT T1.ID, T1.APPLICATION_ID, T2.APPLICATION_NO, T2.APP_TYPE, T2.STATUS, T2.SERVICE_ID, T3.HCI_CODE, T3.HCI_NAME, T4.SUBMIT_DT, T4.IS_PRE_INSPECTION,
             (T3.BLK_NO + ' ' + T3.STREET_NAME + ' ' + T3.BUILDING_NAME + ' # '+ T3.FLOOR_NO + '-' + T3.UNIT_NO + ', ' + T3.POSTAL_CODE) AS PREMISE
             FROM APP_PREMISES_CORRELATION T1
             JOIN APPLICATION T2 ON T2.ID = T1.APPLICATION_ID
             JOIN APP_GRP_PREMISES T3 ON T3.ID = T1.APP_GRP_PREM_ID
             JOIN APPLICATION_GROUP T4 ON T4.ID = T2.APP_GRP_ID
             WHERE 1 = 1
             <#if appCorrId_list??> and CONVERT(NVARCHAR(36), T1.ID) IN ${appCorrId_list} </#if>
            ) T5
            WHERE 1 = 1
            <#if application_no??> and T5.APPLICATION_NO = :application_no</#if>
            <#if appCorId_list??> and CONVERT(NVARCHAR(36), T5.ID) IN ${appCorId_list} </#if>
            <#if application_type??> and T5.APP_TYPE = :application_type</#if>
            <#if application_status??> and T5.STATUS = :application_status</#if>
            <#if hci_code??> and charindex(:hci_code, T5.HCI_CODE) >0 </#if>
            <#if hci_name??> and charindex(:hci_name, T5.HCI_NAME) >0 </#if>
            <#if hci_address??> and charindex(:hci_address, T5.PREMISE) >0 </#if>
        ]]>
    </sql>

    <sql key="listChklItem"  remarks="query chechlist items">
        <![CDATA[
                select item.id as ITEM_ID, regulation.CLAUSE_NO as CLAUSE_NO, regulation.clause as CLAUSE,
                item.question AS CHECKLISTITEM, item.answer_type as ANSWER_TYPE, item.risk_level as RISK_LEVEL,
                item.status as STATUS from chkl_config_hcsa_svc_item_pool item, chkl_config_hcsa_svc_regulation regulation where 1 = 1
                and item.regulation_id = regulation.id and item.status = 'CMSTAT001'
                <#if itemId??> and charindex(:itemId, item.id) >0</#if>
                <#if regulationClauseNo??> and charindex(:regulationClauseNo, regulation.clause_no) >0 </#if>
                <#if regulationClause??> and charindex(:regulationClause, regulation.clause) >0 </#if>
                <#if checklistItem??> and charindex(:checklistitem, item.question) >0</#if>
                <#if answerType??> and item.answer_type = :answerType</#if>
                <#if riskLevel??> and item.risk_level = :riskLevel</#if>
                <#if status??> and item.status = :status</#if>
        ]]>

    </sql>

    <sql key="aduitSystemList"  remarks="query system aduitList">
        <![CDATA[
            select t1.id as id, t2.id as licId,t3.HCI_CODE as hclcode,t3.HCI_NAME hclName,
            t3.HCI_NAME+' '+t3.STREET_NAME+' '+t3.UNIT_NO+' '+t3.BLK_NO+',#'+t3.FLOOR_NO+'Singapore '+t3.POSTAL_CODE as address,t3.POSTAL_CODE as postalCode,t3.PREMISES_TYPE premisesType,
            t2.SVC_NAME as serviceName from lic_premises t1,licence t2,premises t3 where t1.LICENCE_ID = t2.id and t1.PREMISES_ID = t3.id and t2.STATUS= 'LICEST001'
            <#if serviceNameList??> and t2.SVC_NAME IN ${serviceNameList} </#if>
            <#if postalCode??> and charindex(:postalCode,t3.POSTAL_CODE)!=0 </#if>
            <#if hclCode??> and charindex(:hclCode,t3.HCI_CODE)!=0 </#if>
            <#if premType??> and charindex(:premType,t3.PREMISES_TYPE) != 0 </#if>
        ]]>
    </sql>



</sqls>