<?xml version="1.0" encoding="UTF-8"?>
<sqls catalog="ReqForInfoQuery">

    <sql key = "applicationQuery" remarks = "Query Application Data by condition">
        <![CDATA[
            SELECT distinct
                app.id,app.application_no,app.app_type,app.status,app.service_id,
                T2.id APP_CORR_ID,
                T3.HCI_CODE,T3.HCI_NAME,
                T3.BLK_NO, T3.FLOOR_NO, T3.UNIT_NO, T3.STREET_NAME, T3.BUILDING_NAME,
                T4.LICENSEE_ID,appRec.RECOM_DECISION RISK_LEVEL
            FROM APPLICATION AS app
             LEFT JOIN APP_PREMISES_CORRELATION T2 ON T2.APPLICATION_ID = app.ID
             LEFT JOIN APP_GRP_PREMISES T3 ON T3.ID = T2.APP_GRP_PREM_ID
             LEFT JOIN APPLICATION_GROUP T4 ON T4.ID = app.APP_GRP_ID
             LEFT JOIN app_grp_personnel appGrpPer ON appGrpPer.APP_GRP_ID = T4.ID
             LEFT JOIN app_grp_personnel_ext appGrpPerExt ON appGrpPer.ID = appGrpPerExt.APP_GRP_PSN_ID
             LEFT JOIN app_svc_key_personnel appKeyPsn ON appKeyPsn.APPLICATION_ID = app.ID
             LEFT JOIN app_premises_recommendation appRec ON (appRec.APP_PREM_CORRE_ID = T2.ID AND appRec.RECOM_TYPE='RETYPE012')
            WHERE 1=1
            <#if id??> AND app.id = :id </#if>
            <#if appType??> AND app.app_type = :appType</#if>
            <#if appNo??> AND charindex(:appNo, app.application_no)>0</#if>
            <#if appStatus??> AND app.status = :appStatus</#if>
            <#if subDate??> AND T4.submit_dt >= convert(datetime,:subDate)</#if>
            <#if toDate??> AND T4.submit_dt <= convert(datetime,:toDate)</#if>
            <#if licenseeId??>AND T4.licensee_id = :licenseeId</#if>
            <#if hciCode??> AND  charindex(:hciCode, T3.HCI_CODE )>0</#if>
            <#if hciName??> AND charindex(:hciName, T3.HCI_NAME )>0</#if>
            <#if hciStreetName??> AND charindex(:hciStreetName, T3.STREET_NAME )>0</#if>
            <#if hciPostalCode??> AND charindex(:hciPostalCode, T3.POSTAL_CODE )>0</#if>
            <#if personnelName??> AND  charindex(:personnelName, appGrpPer.NAME )>0</#if>
            <#if personnelId??> AND charindex(:personnelId, appGrpPer.ID_NO )>0</#if>
            <#if personnelRegnNo??> AND charindex( :personnelRegnNo, appGrpPerExt.PROF_REG_NO )>0</#if>
            <#if personnelRole??> AND  appKeyPsn.PSN_TYPE = :personnelRole</#if>

            <#if licence_status??>AND :licence_status = :licence_status</#if>
            <#if start_date??>AND :start_date = :start_date</#if>
            <#if start_to_date??>AND :start_to_date = :start_to_date</#if>
            <#if expiry_date??>AND :expiry_date = :expiry_date</#if>
            <#if expiry_start_date??>AND :expiry_start_date = :expiry_start_date</#if>
            <#if licence_no??>AND :licence_no = :licence_no</#if>
            <#if app_id??>AND :app_id = :app_id</#if>
            <#if org_ids??>AND :org_ids = :org_ids</#if>
            <#if licenseeIdNo??>AND :licenseeIdNo = :licenseeIdNo</#if>
            <#if licenseeName??> AND :licenseeName = :licenseeName</#if>
            <#if licenseeRegnNo??>AND :licenseeRegnNo = :licenseeRegnNo</#if>
            <#if serviceSubTypeName??>AND :serviceSubTypeName = :serviceSubTypeName</#if>
            <#if svc_name??> AND :svc_name = :svc_name</#if>
        ]]>
    </sql>


    <sql key = "licenceQuery" remarks = "Query Licence Data by condition">
        <![CDATA[
            SELECT distinct
                licApp.id as LIC_APP_ID,
                lic.id as id,
                lic.licence_no as licence_no,
                lic.svc_name as svc_name,
                lic.STATUS as STATUS,
                lic.start_date as start_date,
                lic.expiry_date as expiry_date,
                lic.licensee_id,
                licApp.APPLICATION_ID as APPLICATION_ID
            FROM LICENCE AS lic
            LEFT JOIN LIC_APP_CORRELATION licApp ON licApp.LICENCE_ID = lic.ID
            LEFT JOIN LIC_PREMISES licPrem ON licPrem.LICENCE_ID = lic.ID
            LEFT JOIN PREMISES Prem ON Prem.ID = licPrem.PREMISES_ID
            LEFT JOIN LIC_KEY_PERSONNEL licKeyPsn ON licKeyPsn.LICENCE_ID = lic.ID
            LEFT JOIN KEY_PERSONNEL_EXT keyPsnExt ON keyPsnExt.ID = licKeyPsn.PSN_EXT_ID

            WHERE 1=1
            AND lic.STATUS != 'LICEST002'
            <#if licence_status??> AND lic.STATUS = :licence_status</#if>
            <#if start_date??> AND lic.start_date >= convert(date,:start_date)</#if>
            <#if start_to_date??> AND lic.start_date <= convert(date,:start_to_date)</#if>
            <#if expiry_date??> AND lic.expiry_date <= convert(date,:expiry_date)</#if>
            <#if expiry_start_date??> AND lic.expiry_date >= convert(date,:expiry_start_date)</#if>
            <#if licence_no??> AND charindex(:licence_no, lic.licence_no )>0</#if>
            <#if app_id??> AND licApp.APPLICATION_ID = :app_id</#if>
            <#if org_ids??> AND lic.ORGANIZATION_ID in( :org_ids)</#if>
            <#if hciCode??> AND charindex(:hciCode, Prem.HCI_CODE )>0</#if>
            <#if hciName??> AND charindex(:hciName, Prem.HCI_NAME )>0</#if>
            <#if hciStreetName??> AND charindex(:hciStreetName, Prem.STREET_NAME )>0</#if>
            <#if hciPostalCode??> AND charindex(:hciPostalCode, Prem.POSTAL_CODE )>0</#if>
            <#if svc_names??> AND lic.SVC_NAME in( :svc_names)</#if>
            <#if svc_name??> AND lic.SVC_NAME = :svc_name</#if>
            <#if licenseeRegnNo??> AND charindex( :licenseeRegnNo,keyPsnExt.PROF_REG_NO )>0</#if>
            <#if licenseeId??>AND lic.licensee_id = :licenseeId</#if>

            <#if licenseeIdNo??>AND :licenseeIdNo = :licenseeIdNo</#if>
            <#if licenseeName??> AND :licenseeName = :licenseeName</#if>
            <#if serviceSubTypeName??>AND :serviceSubTypeName = :serviceSubTypeName</#if>
            <#if id??>AND :id = :id</#if>
            <#if appType??>AND :appType = :appType</#if>
            <#if appNo??>AND :appNo = :appNo</#if>
            <#if appStatus??>AND :appStatus = :appStatus</#if>
            <#if subDate??>AND :subDate = :subDate</#if>
            <#if toDate??>AND :toDate = :toDate</#if>
            <#if personnelName??> AND :personnelName = :personnelName</#if>
            <#if personnelId??> AND :personnelId = :personnelId</#if>
            <#if personnelRegnNo??> AND :personnelRegnNo = :personnelRegnNo</#if>
            <#if personnelRole??> AND  :personnelRole = :personnelRole</#if>

        ]]>
    </sql>

    <sql key = "licenseeQuery" remarks = "Query Licensee Data by condition">
        <![CDATA[
            SELECT distinct
                lic.id,
                lic.name,
                lic.organization_id,
                lic.postal_code
            FROM LICENSEE AS lic
            LEFT JOIN ORGANIZATION org ON org.ID = lic.ORGANIZATION_ID
            LEFT JOIN licensee_individual licInd ON licInd.ID = lic.ID
            WHERE 1=1
            <#if uenNo??> AND charindex( :uenNo,org.UEN_NO )>0</#if>
            <#if licenseeIdNo??> AND charindex( :licenseeIdNo,licInd.ID_NO )>0</#if>
            <#if licenseeName??> AND charindex(:licenseeName,lic.NAME )>0</#if>

            <#if licenseeId??>AND :licenseeId = :licenseeId</#if>
            <#if licenseeRegnNo??> AND :licenseeRegnNo = :licenseeRegnNo</#if>
            <#if id??>AND :id = :id</#if>
            <#if appType??>AND :appType = :appType</#if>
            <#if appNo??>AND :appNo = :appNo</#if>
            <#if appStatus??>AND :appStatus = :appStatus</#if>
            <#if subDate??>AND :subDate = :subDate</#if>
            <#if toDate??>AND :toDate = :toDate</#if>
            <#if licence_status??>AND :licence_status = :licence_status</#if>
            <#if start_date??>AND :start_date = :start_date</#if>
            <#if start_to_date??>AND :start_to_date = :start_to_date</#if>
            <#if expiry_date??>AND :expiry_date = :expiry_date</#if>
            <#if expiry_start_date??>AND :expiry_start_date = :expiry_start_date</#if>
            <#if licence_no??>AND :licence_no = :licence_no</#if>
            <#if app_id??>AND :app_id = :app_id</#if>
            <#if org_ids??>AND :org_ids = :org_ids</#if>
            <#if hciCode??>AND :hciCode = :hciCode</#if>
            <#if hciName??>AND :hciName = :hciName</#if>
            <#if hciStreetName??>AND :hciStreetName = :hciStreetName</#if>
            <#if hciPostalCode??>AND :hciPostalCode = :hciPostalCode</#if>
            <#if personnelName??> AND :personnelName = :personnelName</#if>
            <#if personnelId??> AND :personnelId = :personnelId</#if>
            <#if personnelRegnNo??> AND :personnelRegnNo = :personnelRegnNo</#if>
            <#if personnelRole??> AND :personnelRole = :personnelRole</#if>
            <#if svc_name??> AND :svc_name = :svc_name</#if>
            <#if serviceSubTypeName??>AND :serviceSubTypeName = :serviceSubTypeName</#if>
        ]]>
    </sql>

    <sql key = "serviceQuery" remarks = "Query Service Data by condition">
        <![CDATA[
            SELECT distinct
                svc.id,
                svc.SVC_NAME as SVC_NAME
            FROM hcsa_service AS svc
            LEFT JOIN hcsa_service_subtype svcSub ON svcSub.SERVICE_ID = svc.ID

            WHERE 1=1
            <#if serviceSubTypeName??> AND  (svcSub.ID = :serviceSubTypeName OR svcSub.PARENT_ID = :serviceSubTypeName)</#if>

            <#if id??>AND :id = :id</#if>
            <#if appType??>AND :appType = :appType</#if>
            <#if appNo??>AND :appNo = :appNo</#if>
            <#if appStatus??>AND :appStatus = :appStatus</#if>
            <#if subDate??>AND :subDate = :subDate</#if>
            <#if toDate??>AND :toDate = :toDate</#if>
            <#if licence_status??>AND :licence_status = :licence_status</#if>
            <#if start_date??>AND :start_date = :start_date</#if>
            <#if start_to_date??>AND :start_to_date = :start_to_date</#if>
            <#if expiry_date??>AND :expiry_date = :expiry_date</#if>
            <#if expiry_start_date??>AND :expiry_start_date = :expiry_start_date</#if>
            <#if licence_no??>AND :licence_no = :licence_no</#if>
            <#if app_id??>AND :app_id = :app_id</#if>
            <#if org_ids??>AND :org_ids = :org_ids</#if>
            <#if hciCode??>AND :hciCode = :hciCode</#if>
            <#if hciName??>AND :hciName = :hciName</#if>
            <#if hciStreetName??>AND :hciStreetName = :hciStreetName</#if>
            <#if hciPostalCode??>AND :hciPostalCode = :hciPostalCode</#if>
            <#if licenseeId??>AND :licenseeId = :licenseeId</#if>
            <#if licenseeIdNo??>AND :licenseeIdNo = :licenseeIdNo</#if>
            <#if licenseeName??> AND :licenseeName = :licenseeName</#if>
            <#if licenseeRegnNo??>AND :licenseeRegnNo = :licenseeRegnNo</#if>
            <#if personnelName??> AND :personnelName = :personnelName</#if>
            <#if personnelId??> AND :personnelId = :personnelId</#if>
            <#if personnelRegnNo??> AND :personnelRegnNo = :personnelRegnNo</#if>
            <#if personnelRole??> AND :personnelRole = :personnelRole</#if>
            <#if svc_name??> AND :svc_name = :svc_name</#if>
        ]]>
    </sql>

    <sql key="rfi-new" cached="no" remarks="new Request For Information Html">
        <![CDATA[
            <div class="reqForInfoContent">
                <div class="panel panel-default">
                    <div class="panel-collapse collapse in" id="collapseOne" role="tabpanel" aria-labelledby="headingOne" aria-expanded="true" style="">
                        <div class="panel-body">
                            <div class="form-group">
                                <p>
                                <label class="col-xs-9 col-md-4 control-label">Select Category<strong style="color:#ff0000;">*</strong></label>
                                <div class=" col-xs-11 col-sm-4 col-md-5">
                                    (rfiSelect)
                                </div>
                                    <div class=" col-xs-11 col-sm-4 col-md-3">
                                        <div class="form-check removeRfiBtn">
                                          <div class="fa fa-times-circle text-danger"></div>
                                        </div>
                                    </div>
                                </p>
                            </div>
                                 <span class="error-msg" name="iaisErrorMsg" id="error_rfiSelectindexRfi"></span>
                            <br>
                            <div class="form-group">
                                <p>
                                    <label class="col-xs-9 col-md-4 control-label" >Title<strong style="color:#ff0000;">*</strong></label>
                                    <label >
                                        <textarea id="rfiTitleindexRfi" maxlength="500" rows="8" cols="95" style=" font-weight:normal;" name="rfiTitleindexRfi" ></textarea><span id="error_rfiTitleindexRfi" name="iaisErrorMsg" class="error-msg" ></span>
                                    </label>
                                </p>
                                <p>
                                    <label class="col-xs-9 col-md-4 control-label" >Licence No.<strong style="color:#ff0000;">*</strong></label>
                                    <label >
                                        <div class=" col-xs-7 col-sm-4 col-md-5">
                                            (rfiLicSelect) <span id="error_licenceNoindexRfi" name="iaisErrorMsg" class="error-msg" ></span>
                                        </div>
                                    </label>
                                </p>
                                <div class="row"></div>
                                <p>
                                    <label class="col-xs-9 col-md-4 control-label" >Due Date<strong style="color:#ff0000;">*</strong></label>
                                    <label >
                                        <div class="form-group">
                                            <div class=" col-xs-7 col-sm-4 col-md-5">
                                                <input type="text" autocomplete="off" class="date_picker form-control due-date" name="Due_dateindexRfi" id="-66613756688199" data-date-start-date="01/01/1900" placeholder="dd/mm/yyyy" maxlength="10"><span id="error_Due_dateindexRfi" name="iaisErrorMsg" class="error-msg" ></span>
                                            </div>
                                            <div class="clear"></div>
                                        </div>
                                    </label>
                                </p>
                                <p>
                                    <label class="col-xs-9 col-md-4 control-label">
                                        <input type="checkbox" name = "reqTypeindexRfi" />&nbsp;File Upload <input type="hidden" name="lengths" value="indexRfi" />
                                    </label>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
         ]]>
    </sql>

</sqls>