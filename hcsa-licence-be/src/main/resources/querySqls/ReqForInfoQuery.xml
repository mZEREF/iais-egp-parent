<?xml version="1.0" encoding="UTF-8"?>
<sqls catalog="ReqForInfoQuery">

    <sql key = "applicationQuery" remarks = "Query Application Data by condition">
        <![CDATA[
            SELECT distinct
                app.id,app.application_no,app.app_type,app.status,app.service_id,
                T2.id APP_CORR_ID,
                T3.HCI_CODE,T3.HCI_NAME,
                T3.BLK_NO, T3.FLOOR_NO, T3.UNIT_NO, T3.STREET_NAME, T3.BUILDING_NAME,
                T4.LICENSEE_ID,chkl_item.RISK_LEVEL
            FROM APPLICATION AS app
             LEFT JOIN APP_PREMISES_CORRELATION T2 ON T2.APPLICATION_ID = app.ID
             LEFT JOIN APP_GRP_PREMISES T3 ON T3.ID = T2.APP_GRP_PREM_ID
             LEFT JOIN APPLICATION_GROUP T4 ON T4.ID = app.APP_GRP_ID
             LEFT JOIN app_premises_adhoc_chkl_config chkl_config ON chkl_config.APP_PREM_CORRE_ID = T2.ID
             LEFT JOIN app_premises_adhoc_chkl_item chkl_item ON chkl_item.ADHOC_CONF_ID = chkl_config.ID
            WHERE 1=1
            <#if id??> AND app.id = :id </#if>
            <#if appType??> AND app.app_type = :appType</#if>
            <#if appNo??> AND charindex(:appNo, app.application_no)>0</#if>
            <#if appStatus??> AND app.status = :appStatus</#if>
            <#if subDate??> AND T4.submit_dt >= convert(date,:subDate)</#if>
            <#if toDate??> AND T4.submit_dt <= convert(date,:toDate)</#if>
            <#if hciCode??> AND  charindex(:hciCode, T3.HCI_CODE )>0</#if>
            <#if hciName??> AND charindex(:hciName, T3.HCI_NAME )>0</#if>
            <#if hciStreetName??> AND charindex(:hciStreetName, T3.STREET_NAME )>0</#if>
            <#if hciPostalCode??> AND charindex(:hciPostalCode, T3.POSTAL_NAME )>0</#if>
            
            <#if licence_status??>AND :licence_status = :licence_status</#if>
            <#if start_date??>AND :start_date = :start_date</#if>
            <#if start_to_date??>AND :start_to_date = :start_to_date</#if>
            <#if expiry_date??>AND :expiry_date = :expiry_date</#if>
            <#if expiry_start_date??>AND :expiry_start_date = :expiry_start_date</#if>
            <#if licence_no??>AND :licence_no = :licence_no</#if>
            <#if app_id??>AND :app_id = :app_id</#if>
            <#if org_ids??>AND :org_ids = :org_ids</#if>

            <#if licenseeId??>AND :licenseeId = :licenseeId</#if>
            <#if licenseeName??> AND :licenseeName = :licenseeName</#if>
            <#if licenseeRegnNo??>AND :licenseeRegnNo = :licenseeRegnNo</#if>
            <#if serviceId??>AND :serviceId = :serviceId</#if>
            <#if serviceName??>AND :serviceName = :serviceName</#if>
            <#if serviceRole??>AND :serviceRole = :serviceRole</#if>
            <#if serviceRegnNo??>AND :serviceRegnNo = :serviceRegnNo</#if>
        ]]>
    </sql>


    <sql key = "licenceQuery" remarks = "Query Licence Data by condition">
        <![CDATA[
            SELECT distinct
                lic.id as id,
                lic.licence_no as licence_no,
                lic.svc_name as svc_name,
                lic.STATUS as STATUS,
                lic.start_date as start_date,
                lic.expiry_date as expiry_date,
                lic.licensee_id,
                licApp.APPLICATION_ID as APPLICATION_ID,
                Prem.HCI_CODE,Prem.HCI_NAME,
                Prem.BLK_NO, Prem.FLOOR_NO, Prem.UNIT_NO, Prem.STREET_NAME, Prem.BUILDING_NAME,
                licPrem.ID as lic_prem_id,LicPremisesAdhocChklItem.RISK_LEVEL
            FROM LICENCE AS lic
            LEFT JOIN LIC_PREMISES licPrem ON licPrem.LICENCE_ID = lic.ID
            LEFT JOIN PREMISES Prem ON Prem.ID = licPrem.PREMISES_ID
            LEFT JOIN LIC_APP_CORRELATION licApp ON licApp.LICENCE_ID = lic.ID
            LEFT JOIN lic_premises_adhoc_chkl_config LicPremisesAdhocChklCfg ON licPrem.ID = LicPremisesAdhocChklCfg.LIC_PREM_ID
            LEFT JOIN lic_premises_adhoc_chkl_item LicPremisesAdhocChklItem ON LicPremisesAdhocChklCfg.ID = LicPremisesAdhocChklItem.ADHOC_CONF_ID
            WHERE 1=1
            <#if licence_status??> AND lic.STATUS = :licence_status</#if>
            <#if start_date??> AND lic.start_date >= :start_date</#if>
            <#if start_to_date??> AND lic.start_date <= :start_to_date</#if>
            <#if expiry_date??> AND lic.expiry_date <= :expiry_date</#if>
            <#if expiry_start_date??> AND lic.expiry_date >= :expiry_start_date</#if>
            <#if licence_no??> AND charindex(:licence_no, lic.licence_no )>0</#if>
            <#if app_id??> AND licApp.APPLICATION_ID = :app_id</#if>
            <#if org_ids??> AND lic.ORGANIZATION_ID in( :org_ids)</#if>
            <#if hciCode??> AND charindex(:hciCode, Prem.HCI_CODE )>0</#if>
            <#if hciName??> AND charindex(:hciName, Prem.HCI_NAME )>0</#if>
            <#if hciStreetName??> AND charindex(:hciStreetName, Prem.STREET_NAME )>0</#if>
            <#if hciPostalCode??> AND charindex(:hciPostalCode, Prem.POSTAL_NAME )>0</#if>
            <#if svc_names??> AND lic.SVC_NAME in( :svc_names)</#if>
            <#if licenseeIds??> AND lic.LICENSEE_ID in( :licenseeIds)</#if>

            <#if licenseeId??>AND :licenseeId = :licenseeId</#if>
            <#if licenseeName??> AND :licenseeName = :licenseeName</#if>
            <#if licenseeRegnNo??>AND :licenseeRegnNo = :licenseeRegnNo</#if>
            <#if serviceId??>AND :serviceId = :serviceId</#if>
            <#if serviceName??>AND :serviceName = :serviceName</#if>
            <#if serviceRole??>AND :serviceRole = :serviceRole</#if>
            <#if serviceRegnNo??>AND :serviceRegnNo = :serviceRegnNo</#if>
            <#if id??>AND :id = :id</#if>
            <#if appType??>AND :appType = :appType</#if>
            <#if appNo??>AND :appNo = :appNo</#if>
            <#if appStatus??>AND :appStatus = :appStatus</#if>
            <#if subDate??>AND :subDate = :subDate</#if>
            <#if toDate??>AND :toDate = :toDate</#if>
        ]]>
    </sql>

    <sql key = "licenseeQuery" remarks = "Query Licensee Data by condition">
        <![CDATA[
            SELECT distinct
                lic.id,
                lic.name,
                lic.organization_id,
                lic.postal_code
            FROM LICENSEE AS lic
            LEFT JOIN ORGANIZATION org ON org.ID = lic.ORGANIZATION_ID

            WHERE 1=1
            <#if uenNo??> AND charindex( :uenNo,org.UEN_NO )>0</#if>
            <#if licenseeId??> AND lic.id = :licenseeId</#if>
            <#if licenseeName??> AND charindex(:licenseeName,lic.NAME )>0</#if>
            <#if licenseeRegnNo??> AND charindex( :licenseeRegnNo,lic.POSTAL_CODE )>0</#if>
            
            <#if id??>AND :id = :id</#if>
            <#if appType??>AND :appType = :appType</#if>
            <#if appNo??>AND :appNo = :appNo</#if>
            <#if appStatus??>AND :appStatus = :appStatus</#if>
            <#if subDate??>AND :subDate = :subDate</#if>
            <#if toDate??>AND :toDate = :toDate</#if>
            <#if licence_status??>AND :licence_status = :licence_status</#if>
            <#if start_date??>AND :start_date = :start_date</#if>
            <#if start_to_date??>AND :start_to_date = :start_to_date</#if>
            <#if expiry_date??>AND :expiry_date = :expiry_date</#if>
            <#if expiry_start_date??>AND :expiry_start_date = :expiry_start_date</#if>
            <#if licence_no??>AND :licence_no = :licence_no</#if>
            <#if app_id??>AND :app_id = :app_id</#if>
            <#if org_ids??>AND :org_ids = :org_ids</#if>
            <#if hciCode??>AND :hciCode = :hciCode</#if>
            <#if hciName??>AND :hciName = :hciName</#if>
            <#if hciStreetName??>AND :hciStreetName = :hciStreetName</#if>
            <#if hciPostalCode??>AND :hciPostalCode = :hciPostalCode</#if>

            <#if serviceId??>AND :serviceId = :serviceId</#if>
            <#if serviceName??>AND :serviceName = :serviceName</#if>
            <#if serviceRole??>AND :serviceRole = :serviceRole</#if>
            <#if serviceRegnNo??>AND :serviceRegnNo = :serviceRegnNo</#if>
        ]]>
    </sql>

    <sql key = "serviceQuery" remarks = "Query Service Data by condition">
        <![CDATA[
            SELECT distinct
                svc.id,
                svc.SVC_NAME as SVC_NAME
            FROM hcsa_service AS svc
            LEFT JOIN hcsa_service_specific_personnel svcPersonnel ON svcPersonnel.SERVICE_ID = svc.ID

            WHERE 1=1
            <#if serviceId??> AND svc.id = :serviceId</#if>
            <#if serviceName??> AND charindex( :serviceName,svc.SVC_NAME )>0</#if>
            <#if serviceRole??> AND charindex( :serviceRole,svcPersonnel.PSN_TYPE )>0</#if>
            <#if serviceRegnNo??> AND charindex( :serviceRegnNo,svcPersonnel.ID )>0</#if>
            
            <#if id??>AND :id = :id</#if>
            <#if appType??>AND :appType = :appType</#if>
            <#if appNo??>AND :appNo = :appNo</#if>
            <#if appStatus??>AND :appStatus = :appStatus</#if>
            <#if subDate??>AND :subDate = :subDate</#if>
            <#if toDate??>AND :toDate = :toDate</#if>
            <#if licence_status??>AND :licence_status = :licence_status</#if>
            <#if start_date??>AND :start_date = :start_date</#if>
            <#if start_to_date??>AND :start_to_date = :start_to_date</#if>
            <#if expiry_date??>AND :expiry_date = :expiry_date</#if>
            <#if expiry_start_date??>AND :expiry_start_date = :expiry_start_date</#if>
            <#if licence_no??>AND :licence_no = :licence_no</#if>
            <#if app_id??>AND :app_id = :app_id</#if>
            <#if org_ids??>AND :org_ids = :org_ids</#if>
            <#if hciCode??>AND :hciCode = :hciCode</#if>
            <#if hciName??>AND :hciName = :hciName</#if>
            <#if hciStreetName??>AND :hciStreetName = :hciStreetName</#if>
            <#if hciPostalCode??>AND :hciPostalCode = :hciPostalCode</#if>

            <#if licenseeId??>AND :licenseeId = :licenseeId</#if>
            <#if licenseeName??> AND :licenseeName = :licenseeName</#if>
            <#if licenseeRegnNo??>AND :licenseeRegnNo = :licenseeRegnNo</#if>
        ]]>
    </sql>

</sqls>