<?xml version="1.0" encoding="UTF-8"?>
<sqls catalog="ReqForInfoQuery">

    <sql key = "applicationQuery" remarks = "Query Application Data by condition">
        <![CDATA[
            SELECT distinct
                app.id,app.application_no,app.app_type,app.status,app.service_id,
                T2.id APP_CORR_ID,
                T3.HCI_CODE,T3.HCI_NAME,
                T3.BLK_NO, T3.FLOOR_NO, T3.UNIT_NO, T3.STREET_NAME, T3.BUILDING_NAME,T3.POSTAL_CODE,
                T4.LICENSEE_ID,appRec.RECOM_DECISION RISK_LEVEL
            FROM APPLICATION AS app
            JOIN (select application_no,MAX(version) as version from application GROUP BY application_no) as app2
            ON app.APPLICATION_NO = app2.application_no and app.version = app2.version
             LEFT JOIN APP_PREMISES_CORRELATION T2 ON T2.APPLICATION_ID = app.ID
             LEFT JOIN APP_GRP_PREMISES T3 ON T3.ID = T2.APP_GRP_PREM_ID
             LEFT JOIN APPLICATION_GROUP T4 ON T4.ID = app.APP_GRP_ID
             LEFT JOIN app_grp_personnel appGrpPer ON appGrpPer.APP_GRP_ID = T4.ID
             LEFT JOIN app_svc_personnel appSvcPer ON appSvcPer.APPLICATION_ID = app.ID
             LEFT JOIN app_grp_personnel_ext appGrpPerExt ON appGrpPer.ID = appGrpPerExt.APP_GRP_PSN_ID
             LEFT JOIN app_svc_key_personnel appKeyPsn ON appKeyPsn.APPLICATION_ID = app.ID
             LEFT JOIN app_premises_recommendation appRec ON (appRec.APP_PREM_CORRE_ID = T2.ID AND appRec.RECOM_TYPE='RETYPE012' AND appRec.STATUS='CMSTAT001')
            WHERE 1=1
            <#if id??> AND app.id = :id </#if>
            <#if appType??> AND app.app_type = :appType</#if>
            <#if appNo??> AND charindex(:appNo, app.application_no)>0</#if>
            <#if appStatus??> AND app.status = :appStatus</#if>
            <#if appStatus_APPROVED??>AND ${appStatus_APPROVED}</#if>
            <#if appGrpPmtStatus??> AND T4.PMT_STATUS = :appGrpPmtStatus</#if>
            <#if subDate??> AND T4.submit_dt >= convert(datetime,:subDate)</#if>
            <#if toDate??> AND T4.submit_dt <= convert(datetime,:toDate)</#if>
            <#if licenseeId??>AND T4.licensee_id = :licenseeId</#if>
            <#if hciName??> AND charindex(:hciName, T3.HCI_NAME )>0</#if>
            <#if hciStreetName??> AND charindex(:hciStreetName, T3.STREET_NAME )>0</#if>
            <#if hciPostalCode??> AND charindex(:hciPostalCode, T3.POSTAL_CODE )>0</#if>
            <#if personnelName??> AND ( charindex(:personnelName, appSvcPer.NAME )>0 OR charindex(:personnelName, appGrpPer.NAME )>0)</#if>
            <#if personnelId??> AND charindex(:personnelId, appGrpPer.ID_NO )>0</#if>
            <#if personnelRegnNo??> AND (charindex( :personnelRegnNo, appSvcPer.PROF_REG_NO )>0 OR charindex( :personnelRegnNo, appGrpPerExt.PROF_REG_NO )>0)</#if>
            <#if personnelRole??> AND  appKeyPsn.PSN_TYPE = :personnelRole</#if>
            <#if svc_id??> AND app.SERVICE_ID = :svc_id</#if>
            <#if hciCode??> AND  (T3.HCI_CODE IS NULL OR T3.HCI_CODE = :hciCode)</#if>

            <#if licence_status??>AND :licence_status = :licence_status</#if>
            <#if start_date??>AND :start_date = :start_date</#if>
            <#if start_to_date??>AND :start_to_date = :start_to_date</#if>
            <#if expiry_date??>AND :expiry_date = :expiry_date</#if>
            <#if expiry_start_date??>AND :expiry_start_date = :expiry_start_date</#if>
            <#if licence_no??>AND :licence_no = :licence_no</#if>
            <#if app_id??>AND :app_id = :app_id</#if>
            <#if org_ids??>AND :org_ids = :org_ids</#if>
            <#if licenseeIdNo??>AND :licenseeIdNo = :licenseeIdNo</#if>
            <#if licenseeName??> AND :licenseeName = :licenseeName</#if>
            <#if licenseeRegnNo??>AND :licenseeRegnNo = :licenseeRegnNo</#if>
            <#if serviceSubTypeName??>AND :serviceSubTypeName = :serviceSubTypeName</#if>
            <#if svc_name??> AND :svc_name = :svc_name</#if>
        ]]>
    </sql>


    <sql key = "licenceQuery" remarks = "Query Licence Data by condition">
        <![CDATA[
            SELECT distinct
                CONCAT(lic.id ,case licApp.id when null then '' else licApp.id end) as LIC_APP_KEY_ID,
                licApp.id as LIC_APP_ID,
                lic.id as id,
                lic.licence_no as licence_no,
                lic.svc_name as svc_name,
                lic.STATUS as STATUS,
                lic.start_date as start_date,
                lic.expiry_date as expiry_date,
                lic.licensee_id,
                licApp.APPLICATION_ID as APPLICATION_ID
            FROM LICENCE AS lic
            LEFT JOIN LIC_APP_CORRELATION licApp ON licApp.LICENCE_ID = lic.ID
            LEFT JOIN LIC_PREMISES licPrem ON licPrem.LICENCE_ID = lic.ID
            LEFT JOIN PREMISES Prem ON Prem.ID = licPrem.PREMISES_ID
            LEFT JOIN LIC_KEY_PERSONNEL licKeyPsn ON licKeyPsn.LICENCE_ID = lic.ID
            LEFT JOIN KEY_PERSONNEL_EXT keyPsnExt ON keyPsnExt.ID = licKeyPsn.PSN_EXT_ID

            WHERE 1=1
            <#if licence_status??> AND lic.STATUS = :licence_status</#if>
            <#if start_date??> AND lic.start_date >= convert(date,:start_date)</#if>
            <#if start_to_date??> AND lic.start_date <= convert(date,:start_to_date)</#if>
            <#if expiry_date??> AND lic.expiry_date <= convert(date,:expiry_date)</#if>
            <#if expiry_start_date??> AND lic.expiry_date >= convert(date,:expiry_start_date)</#if>
            <#if licence_no??> AND charindex(:licence_no, lic.licence_no )>0</#if>
            <#if app_id??> AND licApp.APPLICATION_ID = :app_id</#if>
            <#if org_ids??> AND lic.ORGANIZATION_ID in( :org_ids)</#if>
            <#if hciCode??> AND charindex(:hciCode, Prem.HCI_CODE )>0</#if>
            <#if hciName??> AND charindex(:hciName, Prem.HCI_NAME )>0</#if>
            <#if hciStreetName??> AND charindex(:hciStreetName, Prem.STREET_NAME )>0</#if>
            <#if hciPostalCode??> AND charindex(:hciPostalCode, Prem.POSTAL_CODE )>0</#if>
            <#if svc_names??> AND lic.SVC_NAME in( :svc_names)</#if>
            <#if svc_name??> AND lic.SVC_NAME = :svc_name</#if>
            <#if licenseeRegnNo??> AND charindex( :licenseeRegnNo,keyPsnExt.PROF_REG_NO )>0</#if>
            <#if licenseeId??>AND ${licenseeId}</#if>

            <#if licenseeIdNo??>AND :licenseeIdNo = :licenseeIdNo</#if>
            <#if licenseeName??> AND :licenseeName = :licenseeName</#if>
            <#if serviceSubTypeName??>AND :serviceSubTypeName = :serviceSubTypeName</#if>
            <#if id??>AND :id = :id</#if>
            <#if appType??>AND :appType = :appType</#if>
            <#if appNo??>AND :appNo = :appNo</#if>
            <#if appStatus??>AND :appStatus = :appStatus</#if>
            <#if appGrpPmtStatus??> AND :appGrpPmtStatus = :appGrpPmtStatus</#if>
            <#if subDate??>AND :subDate = :subDate</#if>
            <#if toDate??>AND :toDate = :toDate</#if>
            <#if personnelName??> AND :personnelName = :personnelName</#if>
            <#if personnelId??> AND :personnelId = :personnelId</#if>
            <#if personnelRegnNo??> AND :personnelRegnNo = :personnelRegnNo</#if>
            <#if personnelRole??> AND  :personnelRole = :personnelRole</#if>
            <#if svc_id??> AND :svc_id = :svc_id</#if>

        ]]>
    </sql>

    <sql key = "licenseeQuery" remarks = "Query Licensee Data by condition">
        <![CDATA[
            SELECT distinct
                lic.id,
                lic.name,
                lic.organization_id,
                lic.postal_code
            FROM LICENSEE AS lic
            LEFT JOIN ORGANIZATION org ON org.ID = lic.ORGANIZATION_ID
            LEFT JOIN licensee_individual licInd ON licInd.ID = lic.ID
            WHERE 1=1
            <#if uenNo??> AND charindex( :uenNo,org.UEN_NO )>0</#if>
            <#if licenseeIdNo??> AND charindex( :licenseeIdNo,licInd.ID_NO )>0</#if>
            <#if licenseeName??> AND charindex(:licenseeName,lic.NAME )>0</#if>

            <#if licenseeId??>AND :licenseeId = :licenseeId</#if>
            <#if licenseeRegnNo??> AND :licenseeRegnNo = :licenseeRegnNo</#if>
            <#if id??>AND :id = :id</#if>
            <#if appType??>AND :appType = :appType</#if>
            <#if appNo??>AND :appNo = :appNo</#if>
            <#if appStatus??>AND :appStatus = :appStatus</#if>
            <#if appGrpPmtStatus??> AND :appGrpPmtStatus = :appGrpPmtStatus</#if>
            <#if subDate??>AND :subDate = :subDate</#if>
            <#if toDate??>AND :toDate = :toDate</#if>
            <#if licence_status??>AND :licence_status = :licence_status</#if>
            <#if start_date??>AND :start_date = :start_date</#if>
            <#if start_to_date??>AND :start_to_date = :start_to_date</#if>
            <#if expiry_date??>AND :expiry_date = :expiry_date</#if>
            <#if expiry_start_date??>AND :expiry_start_date = :expiry_start_date</#if>
            <#if licence_no??>AND :licence_no = :licence_no</#if>
            <#if app_id??>AND :app_id = :app_id</#if>
            <#if org_ids??>AND :org_ids = :org_ids</#if>
            <#if hciCode??>AND :hciCode = :hciCode</#if>
            <#if hciName??>AND :hciName = :hciName</#if>
            <#if hciStreetName??>AND :hciStreetName = :hciStreetName</#if>
            <#if hciPostalCode??>AND :hciPostalCode = :hciPostalCode</#if>
            <#if personnelName??> AND :personnelName = :personnelName</#if>
            <#if personnelId??> AND :personnelId = :personnelId</#if>
            <#if personnelRegnNo??> AND :personnelRegnNo = :personnelRegnNo</#if>
            <#if personnelRole??> AND :personnelRole = :personnelRole</#if>
            <#if svc_name??> AND :svc_name = :svc_name</#if>
            <#if serviceSubTypeName??>AND :serviceSubTypeName = :serviceSubTypeName</#if>
            <#if svc_id??> AND :svc_id = :svc_id</#if>
        ]]>
    </sql>

    <sql key = "serviceQuery" remarks = "Query Service Data by condition">
        <![CDATA[
            SELECT distinct
                svc.id,
                svc.SVC_NAME as SVC_NAME
            FROM hcsa_service AS svc
            LEFT JOIN hcsa_service_subtype svcSub ON svcSub.SERVICE_ID = svc.ID

            WHERE 1=1
            <#if serviceSubTypeName??> AND  (svcSub.ID = :serviceSubTypeName OR svcSub.PARENT_ID = :serviceSubTypeName)</#if>

            <#if id??>AND :id = :id</#if>
            <#if appType??>AND :appType = :appType</#if>
            <#if appNo??>AND :appNo = :appNo</#if>
            <#if appStatus??>AND :appStatus = :appStatus</#if>
            <#if appGrpPmtStatus??> AND :appGrpPmtStatus = :appGrpPmtStatus</#if>
            <#if subDate??>AND :subDate = :subDate</#if>
            <#if toDate??>AND :toDate = :toDate</#if>
            <#if licence_status??>AND :licence_status = :licence_status</#if>
            <#if start_date??>AND :start_date = :start_date</#if>
            <#if start_to_date??>AND :start_to_date = :start_to_date</#if>
            <#if expiry_date??>AND :expiry_date = :expiry_date</#if>
            <#if expiry_start_date??>AND :expiry_start_date = :expiry_start_date</#if>
            <#if licence_no??>AND :licence_no = :licence_no</#if>
            <#if app_id??>AND :app_id = :app_id</#if>
            <#if org_ids??>AND :org_ids = :org_ids</#if>
            <#if hciCode??>AND :hciCode = :hciCode</#if>
            <#if hciName??>AND :hciName = :hciName</#if>
            <#if hciStreetName??>AND :hciStreetName = :hciStreetName</#if>
            <#if hciPostalCode??>AND :hciPostalCode = :hciPostalCode</#if>
            <#if licenseeId??>AND :licenseeId = :licenseeId</#if>
            <#if licenseeIdNo??>AND :licenseeIdNo = :licenseeIdNo</#if>
            <#if licenseeName??> AND :licenseeName = :licenseeName</#if>
            <#if licenseeRegnNo??>AND :licenseeRegnNo = :licenseeRegnNo</#if>
            <#if personnelName??> AND :personnelName = :personnelName</#if>
            <#if personnelId??> AND :personnelId = :personnelId</#if>
            <#if personnelRegnNo??> AND :personnelRegnNo = :personnelRegnNo</#if>
            <#if personnelRole??> AND :personnelRole = :personnelRole</#if>
            <#if svc_name??> AND :svc_name = :svc_name</#if>
            <#if svc_id??> AND :svc_id = :svc_id</#if>
        ]]>
    </sql>

    <sql key="rfi-new" cached="no" remarks="new Request For Information add doc Html">
        <![CDATA[
            <div class="reqForInfoContent">
                <input type="hidden" name="lengths" value="indexRfi" />
                <div class=" col-xs-11 col-sm-4 col-md-1">
                    <div class="form-check removeRfiBtn">
                        <button class=" btn btn-secondary" type="button">-</button>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-collapse collapse in"  role="tabpanel" aria-labelledby="headingOne" aria-expanded="true" style="">
                        <div class="panel-body">
                            <div class="form-group">
                                <div class="row" >
                                </div>
                                <div class="row" >
                                    <label class="col-xs-9 col-md-3 control-label" ></label>
                                    <label class="col-xs-9 col-md-6 control-label" style="text-align:center;"> indexTitleRfi Title of Supporting Documents <strong style="color:#ff0000;">*</strong></label>
                                </div>
                                <div class="row" >
                                    <label class="col-xs-9 col-md-3 control-label" ></label>
                                    <label class="col-xs-9 col-md-6 control-label">
                                        <textarea  name="docTitleindexRfi" style=" font-weight:normal;" rows="8" maxlength="500" cols="64"></textarea>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <br><br><br>
            </div>
         ]]>
    </sql>


    <sql key="rfi-info-new" cached="no" remarks="new Request For Information add info Html">
        <![CDATA[
            <div class="reqForInfoContentInfo">
                <input type="hidden" name="lengthsInfo" value="indexRfi" />
                <div class=" col-xs-11 col-sm-4 col-md-1">
                    <div class="form-check removeRfiInfoBtn">
                        <button class=" btn btn-secondary" type="button">-</button>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-collapse collapse in"  role="tabpanel" aria-labelledby="headingOne" aria-expanded="true" style="">
                        <div class="panel-body">
                            <div class="form-group">
                                <div class="row" >
                                </div>
                                <div class="row" >
                                    <label class="col-xs-9 col-md-3 control-label" ></label>
                                    <label class="col-xs-9 col-md-6 control-label" style="text-align:center;" > indexTitleRfi Title of Information Required <strong style="color:#ff0000;">*</strong></label>
                                </div>
                                <div class="row" >
                                    <label class="col-xs-9 col-md-3 control-label" ></label>
                                    <label class="col-xs-9 col-md-6 control-label">
                                        <textarea  name="infoTitleindexRfi" style=" font-weight:normal;" rows="8" maxlength="500" cols="64"></textarea>
                                    </label>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <br><br><br>
            </div>
         ]]>
    </sql>

</sqls>