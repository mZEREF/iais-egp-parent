<?xml version="1.0" encoding="UTF-8"?>
<sqls catalog="giroPayee">
    <sql key = "searchByGiroAcctInfo" remarks="search by GIRO Payee account information">
        <![CDATA[
            SELECT distinct gai.ID, gai.ORGANIZATION_ID, gai.HCI_CODE,
            gai.BANK_CODE, gai.BANK_NAME, gai.BRANCH_CODE, gai.ACCT_NAME, gai.ACCT_NO,
            gai.DDA_REF_NO ,p.HCI_NAME

            FROM giro_account_info gai
            join premises p on p.HCI_CODE = gai.HCI_CODE and version =(select Max(version) from premises pre where pre.HCI_CODE =p.HCI_CODE)
            where gai.STATUS = 'CMSTAT001'
            <#if hciCode??> AND charindex(:hciCode, gai.HCI_CODE) >0 </#if>
            <#if cusRefNo??> AND charindex(:cusRefNo, gai.DDA_REF_NO) >0 </#if>

        ]]>
    </sql>

    <sql key = "searchByOrgPremView" remarks="search by Organization Premises View">
        <![CDATA[
            SELECT distinct opv.OP_ID,opv.ID, opv.HCI_CODE, opv.HCI_NAME, opv.UEN_NO
            from organizationPremisesView opv
            where 1 = 1
            <#if hciCode??> AND charindex(:hciCode, opv.HCI_CODE) >0 </#if>
            <#if hciName??> AND charindex(:hciName, opv.HCI_NAME) >0 </#if>
            <#if uenNo??> AND charindex(:uenNo, opv.UEN_NO) >0 </#if>
            <#if orgPremIds??> AND ${orgPremIds} </#if>

        ]]>
    </sql>
    <sql key = "searchGiroDeduction" remarks="search ">
        <![CDATA[
        SELECT * from (
        select dbo.f_hcinameconcat(ag.ID) as HCI_NAME,
        a.ID,a.APP_GROUP_NO,a.AMOUNT,a.PMT_TYPE,a.PMT_STATUS,a.TXN_REF_NO,a.INVOICE_NO,a.ACCT_NO,a.PAY_DESC
        from hcsala.dbo.application_group as ag , giro_payment_view as a  WHERE ag.GROUP_NO=a.APP_GROUP_NO )
        t1 where 1=1 and PMT_STATUS in ('PMT09','PMT03')
        <#if groupNo??> and APP_GROUP_NO like CONCAT('%',:groupNo,'%') </#if>
        <#if acctNo??>and ACCT_NO like CONCAT('%',:acctNo,'%')</#if>
        <#if amount??>and AMOUNT like CONCAT('%',:amount,'%')</#if>
        <#if txnRefNo??> and TXN_REF_NO like CONCAT('%',:txnRefNo,'%')</#if>
        <#if hciName??> and HCI_NAME like CONCAT('%',:hciName,'%')</#if>
        ]]>
    </sql>

</sqls>