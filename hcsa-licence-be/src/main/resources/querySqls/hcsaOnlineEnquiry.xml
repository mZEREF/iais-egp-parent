<?xml version="1.0" encoding="UTF-8"?>
<sqls catalog="hcsaOnlineEnquiry">
    <sql key = "mainOnlineEnquiry" remarks="main query hcsa licence and application">
        <![CDATA[
             SELECT distinct
                 mainView.LIC_APP_KEY_ID, mainView.APPLICATION_ID, mainView.application_no, mainView.app_type, mainView.appStatus, mainView.APP_SVC_NAME,
                 mainView.ADDRESS, mainView.LIC_ADDRESS, mainView.LICENCE_ID, mainView.licence_no, mainView.svc_name, mainView.LicSTATUS, mainView.start_date, mainView.expiry_date,
                 mainView.app_licensee_id_no, mainView.lic_licensee_id_no, mainView.APP_BUSINESS_NAME, mainView.LIC_BUSINESS_NAME, mainView.APP_PREM_TYPE, mainView.LIC_PREM_TYPE,
                 mainView.APP_LICENSEE_NAME, mainView.LIC_LICENSEE_NAME, mainView.LAST_INSP_START_DATE

            FROM LIC_APP_MAIN_QUERY_RESULT_VIEW mainView
            WHERE 1=1
            <#if getLicenceNo??>AND :getLicenceNo = mainView.licence_no </#if>
            <#if getApplicationNo??> AND charindex(:getApplicationNo , mainView.application_no )>0</#if>
            <#if getLicenceStatus??> AND mainView.LicSTATUS = :getLicenceStatus</#if>
            <#if getLicenseeIdNo??> AND (charindex(:getLicenseeIdNo , mainView.app_licensee_id_no )>0 or charindex(:getLicenseeIdNo , mainView.lic_licensee_id_no )>0)</#if>
            <#if getBusinessName??> AND (charindex(:getBusinessName , mainView.APP_BUSINESS_NAME )>0 or charindex(:getBusinessName , mainView.LIC_BUSINESS_NAME )>0)</#if>
            <#if getLicenseeName??> AND (charindex(:getLicenseeName , mainView.APP_LICENSEE_NAME )>0 or charindex(:getLicenseeName , mainView.LIC_LICENSEE_NAME )>0)</#if>
            <#if getInspectionDateFrom??> AND mainView.LAST_INSP_START_DATE >= convert(date,:getInspectionDateFrom)</#if>
            <#if getInspectionDateTo??> AND mainView.LAST_INSP_START_DATE <= convert(datetime,:getInspectionDateTo)</#if>
        ]]>
    </sql>

    <sql key = "licenceOnlineEnquiry" remarks="query hcsa licence">
        <![CDATA[
             SELECT distinct
                 lqrv.LICENCE_ID, lqrv.LICENCE_NO, lqrv.SVC_NAME, lqrv.START_DATE, lqrv.EXPIRY_DATE, lqrv.BUSINESS_NAME, lqrv.PREMISES_TYPE,
                 lqrv.POSTAL_CODE, lqrv.STREET_NAME, lqrv.LicSTATUS, lqrv.LICENSEE_NAME, lqrv.LICENSEE_ID_NO, lqrv.CATEGORY, lqrv.VEHICLE_NUM,
                 lqrv.DICIPLINE_SS, lqrv.ADDRESS, lqrv.LAST_INSP_START_DATE
            FROM LICENCE_QUERY_RESULT_VIEW lqrv
            WHERE 1=1
            <#if getLicenceNo??>AND :getLicenceNo = lqrv.LICENCE_NO </#if>
            <#if getStreetName??> AND charindex(:getStreetName , lqrv.STREET_NAME )>0</#if>
            <#if getLicenceStatus??> AND lqrv.LicSTATUS = :getLicenceStatus</#if>
            <#if getLicenseeIdNo??> AND charindex(:getLicenseeIdNo , lqrv.LICENSEE_ID_NO )>0</#if>
            <#if getBusinessName??> AND charindex(:getBusinessName , lqrv.BUSINESS_NAME )>0</#if>
            <#if getLicenseeName??> AND charindex(:getLicenseeName , lqrv.LICENSEE_NAME )>0</#if>
            <#if getMosdType??> AND lqrv.PREMISES_TYPE = :getMosdType</#if>
            <#if getPostalCode??>AND :getPostalCode = lqrv.POSTAL_CODE </#if>
            <#if getVehicleNo??> AND charindex(:getVehicleNo , lqrv.VEHICLE_NUM )>0</#if>
            <#if getServiceName??>AND  lqrv.SVC_NAME = :getServiceName</#if>
            <#if licenceIds??>AND  lqrv.LICENCE_ID in (:licenceIds)</#if>

        ]]>
    </sql>

    <sql key = "applicationTabOnlineEnquiry" remarks="query hcsa licence for application tab">
        <![CDATA[
             SELECT distinct
                 atqrv.APP_ID, atqrv.APPLICATION_NO, atqrv.APP_TYPE, atqrv.BUSINESS_NAME, atqrv.SUBMIT_DT, atqrv.SUBMIT_BY, atqrv.AUTO_APPROVE,
                 atqrv.APP_STATUS, atqrv.DISPLAY_NAME, atqrv.PMT_STATUS, atqrv.VEHICLE_NUM
            FROM APPLICATION_TAB_QUERY_RESULT_VIEW atqrv
            WHERE 1=1
            <#if licenceId??>AND (:licenceId = atqrv.ORIGIN_LICENCE_ID or :licenceId = atqrv.LICENCE_ID) </#if>
            <#if getApplicationNo??> AND charindex(:getApplicationNo , atqrv.APPLICATION_NO )>0</#if>
            <#if appStatusAll??> AND ${appStatusAll}</#if>
            <#if getBusinessName??> AND charindex(:getBusinessName , atqrv.BUSINESS_NAME )>0</#if>
            <#if getVehicleNo??> AND charindex(:getVehicleNo , atqrv.VEHICLE_NUM )>0</#if>


        ]]>
    </sql>

    <sql key = "adHocRfiTabOnlineEnquiry" remarks="query hcsa licence for adHoc Rfi Tab">
        <![CDATA[
             SELECT distinct
                 rfiTab.RFI_ID, rfiTab.REQUEST_DATE, rfiTab.DUE_DATE_SUBMISSION, rfiTab.LICENCE_NO, rfiTab.REQUEST_USER, rfiTab.TITLE, rfiTab.REPLY_DATE, rfiTab.STATUS

            FROM ADHOC_RFI_TAB_QUERY_RESULT_VIEW rfiTab
            WHERE 1=1
            <#if licenceId??>AND :licenceId = rfiTab.LIC_ID </#if>
            <#if getLicenceNo??> AND charindex(:getLicenceNo , rfiTab.LICENCE_NO )>0</#if>
            <#if getRequestedBy??>AND :getRequestedBy = rfiTab.REQUEST_USER </#if>
            <#if getDueDateFrom??> AND rfiTab.DUE_DATE_SUBMISSION >= convert(date,:getDueDateFrom)</#if>
            <#if getDueDateTo??> AND rfiTab.DUE_DATE_SUBMISSION <= convert(datetime,:getDueDateTo)</#if>
            <#if getRequestDateFrom??> AND rfiTab.REQUEST_DATE >= convert(date,:getRequestDateFrom)</#if>
            <#if getRequestDateTo??> AND rfiTab.REQUEST_DATE <= convert(datetime,:getRequestDateTo)</#if>
        ]]>
    </sql>

    <sql key = "inspectionsTabOnlineEnquiry" remarks="query hcsa licence for Inspections Tab">
        <![CDATA[
             SELECT distinct
                 insTab.ID, insTab.APPLICATION_NO, insTab.APP_TYPE, insTab.BUSINESS_NAME, insTab.APP_STATUS, insTab.LAST_INSP_START_DATE, insTab.INSP_NAME, insTab.VEHICLE_NUM,
                 insTab.ORIGIN_LICENCE_ID, insTab.LICENCE_ID, insTab.INSPECTION_TYPE, insTab.COMPLIANCE, insTab.LAST_RISK_LEVEL, insTab.REASON, insTab.AUDIT_TYPE, insTab.TCU_DATE, insTab.NC_NUM

            FROM INSPECTION_TAB_QUERY_RESULT_VIEW insTab
            WHERE 1=1
             <#if licenceId??>AND (:licenceId = insTab.ORIGIN_LICENCE_ID or :licenceId = insTab.LICENCE_ID) </#if>
            <#if getApplicationNo??> AND charindex(:getApplicationNo , insTab.APPLICATION_NO )>0</#if>
            <#if appStatusAll??> AND ${appStatusAll}</#if>
            <#if getBusinessName??> AND charindex(:getBusinessName , insTab.BUSINESS_NAME )>0</#if>
            <#if getVehicleNo??> AND charindex(:getVehicleNo , insTab.VEHICLE_NUM )>0</#if>
            <#if getInspectionType??>AND :getInspectionType = insTab.INSPECTION_TYPE </#if>
            <#if getInspectionDateFrom??> AND insTab.LAST_INSP_START_DATE >= convert(date,:getInspectionDateFrom)</#if>
            <#if getInspectionDateTo??> AND insTab.LAST_INSP_START_DATE <= convert(datetime,:getInspectionDateTo)</#if>
        ]]>
    </sql>





</sqls>

